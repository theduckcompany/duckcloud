{{ $url := pathJoin "/browser" $.folder.ID $.fullPath}}
<section id="content" class="p-4" hx-get="{{$url}}" hx-trigger="refresh-event">
  <div id="status-bar"></div>
  <div class="row justify-content-between">
    <div class="col-md-10 col-8">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb user-select-none">
          {{range .breadcrumb}}
          <li class="breadcrumb-item{{if not .Current}} active{{end}}" {{if .Current}}aria_current="page" {{end}}>
            {{if not .Current}}<a href="{{.Href}}" class="text-truncate">{{.Name}}</a>{{else}}{{.Name}}{{end}}
          </li>
          {{end}}
        </ol>
      </nav>
    </div>

    <div class="col-md-2 col-4">
      <button id="upload-btn" class="btn btn-primary button-lg">Upload</button>
    </div>
  </div>

  <br>

  <div class="row d-flex justify-content-between user-select-none">
    <div class="col-md-7">Name</div>
    <div class="col-md-5 row text-center text-muted d-none d-md-flex d-lg-flex d-xxl-flex d-xl-flex">
      <div class="col-4">Size</div>
      <div class="col-5">Modified</div>
    </div>
  </div>

  <hr class="mb-1">


  {{range $idx, $val := .inodes}}
  {{ $url := pathJoin "/browser" $.folder.ID $.fullPath $val.Name}}

  <div class="row border-bottom py-1 d-flex justify-content-between align-items-center">
    <div class="col-9 col-md-7 position-relative d-inline-block text-truncate">
      <a class="link-dark user-select-none stretched-link" href="{{$url}}">
        <i class="bi {{getInodeIconClass $val.Name $val.IsDir}} me-2" style="font-size: 2rem;"></i>
        {{.Name}}
      </a>
    </div>

    <div class="col-3 col-md-5 row text-center">
      <div class="col-4 text-muted d-none d-md-block d-lg-block d-xxl-block d-xl-block">{{humanSize $val.USize}}
      </div>
      <div class="col-5 text-muted d-none d-md-block d-lg-block d-xxl-block d-xl-block">{{humanTime
        $val.LastModifiedAt}}</div>

      <div class="col-2 dropdown">
        <a class="btn btn-white btn-rounded" href="#" role="button" id="dropdownMenuLink{{$idx}}"
          data-mdb-toggle="dropdown" aria-expanded="false"><i class="bi bi-three-dots text-muted"
            style="font-size: 1.3rem;"></i></a>

        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink{{$idx}}" style="font-size: 1rem;">
          <!-- <li><a class="dropdown-item text-black" href="#"><i class="bi bi-download me-2"></i>Download
                {{if .IsDir}}Folder{{else}}File{{end}}</a>
            </li> -->
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li><a class="dropdown-item text-danger" href="#" hx-target="#content" hx-swap="outerHTML"
              hx-delete="{{$url}}"><i class="bi bi-trash-fill me-2"></i> Delete
              {{if
              .IsDir}}Folder{{else}}File{{end}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  {{end}}
</section>
<script type="module">
  import {Uppy, XHRUpload, Dashboard, StatusBar} from "/assets/js/uppy.min.mjs"
  let client = new Uppy().use(XHRUpload, {
    endpoint: 'http://localhost:8080/browser/upload',
  })

  client.setMeta({rootPath: {{$.fullPath}}})
  client.setMeta({folderID: {{$.folder.ID}}})

  client.use(Dashboard, {
    autoProceed: true,
    fileManagerSelectionType: 'both',
    proudlyDisplayPoweredByUppy: false,
    trigger: "#upload-btn",
    showProgressDetails: true,
    closeModalOnClickOutside: true,
  })
  client.use(StatusBar, {target: '#status-bar'});

  client.on('upload-success', (file) => {
    htmx.trigger("#content", "refresh-event");
  });

</script>
