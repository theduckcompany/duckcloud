{{ $url := pathJoin "/browser" $.folder.ID $.fullPath}}
<section id="content" class="p-4" hx-get="{{$url}}" hx-swap="outerHTML" hx-trigger="refresh-event">
  <div id="status-bar"></div>
  <div class="row justify-content-between">
    <div class="col-md-10 col-8">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb user-select-none">
          {{range .breadcrumb}}
          <li class="breadcrumb-item{{if not .Current}} active{{end}}" {{if .Current}}aria_current="page" {{end}}>
            {{if not .Current}}<a href="{{.Href}}" class="text-truncate">{{.Name}}</a>{{else}}{{.Name}}{{end}}
          </li>
          {{end}}
        </ol>
      </nav>
    </div>

    <div class="col-md-2 col-4">
      <div class="dropdown">
        <button class="d-flex btn btn-primary button-lg dropdown-toggle align-items-center" type="button"
          id="add-button" data-mdb-toggle="dropdown" aria-expanded="false"><i class="bi bi-plus me-1"
            style="font-size: 1.3rem;"></i>Add</button>
        <ul class="dropdown-menu" arai-labelledby="add-button">
          <li><a id="upload-file-btn" class="dropdown-item">Upload File</a></li>
          <li><a id="upload-folder-btn" class="dropdown-item">Upload Folder</a></li>
        </ul>
      </div>
    </div>
  </div>

  <br>

  <div class="row d-flex justify-content-between user-select-none">
    <div class="col-md-7">Name</div>
    <div class="col-md-5 row text-center text-muted d-none d-md-flex d-lg-flex d-xxl-flex d-xl-flex">
      <div class="col-1"></div>
      <div class="col-4">Size</div>
      <div class="col-5">Modified</div>
    </div>
  </div>

  <hr class="mb-1">

  {{template "browser/rows.tmpl" (.)}}

</section>
<script type="module">
  import {Uppy, XHRUpload, StatusBar} from "/assets/js/uppy.min.mjs"
  let client = new Uppy().use(XHRUpload, {
    endpoint: 'https://{{.host}}/browser/upload',
    allowMultipleUploadBatches: true
  })

  client.setMeta({rootPath: {{$.fullPath}}})
  client.setMeta({folderID: {{$.folder.ID}}})
  client.use(StatusBar, {target: '#status-bar'});

  client.on('complete', (result) => {
    htmx.trigger("#content", "refresh-event");
    // console.log('successful files:', result.successful);
    // console.log('failed files:', result.failed);
  });

  document.getElementById('upload-file-btn').
    addEventListener("click", (e) => {
      var input = document.createElement('input');
      input.type = 'file';
      input.multiple = true

      input.onchange = e => {
        for (const file of e.target.files) {
          client.addFile(file)
        }

        client.upload()
      }

      input.click();
    })

  document.getElementById('upload-folder-btn').
    addEventListener("click", (e) => {
      var input = document.createElement('input');
      input.type = 'file';
      input.multiple = true
      input.webkitdirectory = true
      input.mozdirectory = true
      input.directory = true

      input.onchange = e => {
        for (const file of e.target.files) {
          console.log(file)
          console.log(file.webkitRelativePath)
          client.addFile({

            name: file.webkitRelativePath,
            data: file,
            type: file.type,
            source: 'Local',
            isRemote: false,
          })
        }

        client.upload()
      }

      input.click();
    })

</script>
